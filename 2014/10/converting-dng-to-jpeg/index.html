<!doctype html><html lang=es-es><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Sitio web de Claudio Noguera"><meta name=ROBOTS content="INDEX, FOLLOW"><title>Claudio Noguera</title><script src=https://kit.fontawesome.com/911291c64e.js crossorigin=anonymous></script><link rel=icon href=/favicon.png><link rel=stylesheet href=https://frosklis.tk/main.min.3df621cfdc214478d8b44439244ddcb325a0a4d8182c3af9712ec72f414642a6.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-267152-14','auto');ga('send','pageview');}</script></head><body><nav class=sidebar><a href=https://frosklis.tk/><h1 class=tc>Claudio Noguera</h1></a><div><div class="ml5 mr5 mb2 ma1 tc"><a href=https://frosklis.tk/><img src=/claudio_salinas.jpg class=shadow-1 alt=logo></a></div><div class=tc><a class=ma2 href=https://github.com/frosklis><i class="fa-2x fab fa-github" aria-label=github title=github></i></a><a class=ma2 href=https://linkedin.com/in/claudionoguera><i class="fa-2x fab fa-linkedin" aria-label=linkedin title=linkedin></i></a><a class=ma2 href=https://twitter.com/claudio1985><i class="fa-2x fab fa-twitter" aria-label=twitter title=twitter></i></a><a class=ma2 href=https://goodreads.com/claudio85><i class="fa-2x fab fa-goodreads" aria-label=goodreads title=goodreads></i></a></div></div><div class="copyright tc">2020
<a href=https://creativecommons.org/licenses/by/4.0/ aria-label="Creative Commons license"><i class="fa-lg fab fa-creative-commons"></i><i class="fa-lg fab fa-creative-commons-by"></i></a></div></nav><div id=content><article><header><h1>Converting DNG to jpeg</h1><div class=post-meta><i class="far fa-calendar"></i>&nbsp;2014-10-30</div><div class=post-meta><i class="fas fa-tag"></i>&nbsp;
<a href=/tags/raw>raw</a>, <a href=/tags/dng>dng</a>, <a href=/tags/pictures>pictures</a>, <a href=/tags/btsync>btsync</a>, <a href=/tags/scripting>scripting</a></div></header><p>I shoot most of my pictures in RAW with my Nikon D90. Once I transfer them to my computer, I change the format to DNG (I am not sure if this is useful or not, but NEF is Nikon&rsquo;s proprietary format whereas DNG is standard, backed by Adobe and -in theory- future proof). However, raw formats are not useful for quick previewing and most machines do not support it natively (Macs do support it, though).</p><p>Then all my pictures are kept in a hard drive that syncs to some computers using <a href=https://www.bittorrent.com/sync/>bittorrent sync</a>. One of the copies is a HTPC that I have connected to my home TV, so it serves both as a backup in case the hard drive where the pictures are kept is lost or stolen and as a way to see them comfortably in the TV. This is where a script that transforms raw images into jpeg comes handy.</p><p>This script uses <a href=https://www.cybercom.net/~dcoffin/dcraw/>dcraw</a> and I have used info from <a href=https://stackoverflow.com/questions/8699293/how-to-monitor-a-complete-directory-tree-for-changes-in-linux>here</a> and <a href=https://www.mutaku.com/wp/index.php/2011/02/cook-your-raw-photos-into-jpeg-with-linux/>here</a>.</p><p>Check it out <a href=https://gist.github.com/frosklis/466a77f2c9972990a141>here</a>. There are things missing, such as real file change monitoring, but it gets the job done.<pre><code>
#!/bin/bash</p>

<p>export current=<code>pwd</code>
export rawfolder=/home/claudio/sync/fotos
echo $current
echo $rawfolder</p>

<h1 id=list-of-directories>list of directories</h1>

<h1 id=cd-rawfolder-find-regex-type-d-newer-old-dirs-txt-current-dirs-txt-cd-current>cd &ldquo;$rawfolder&rdquo; &amp;&amp; find . ( ! -regex &lsquo;.<em>/..</em>&rsquo; ) -type d -newer old_dirs.txt &gt; &ldquo;$current/dirs.txt&rdquo; &amp;&amp; cd &ldquo;$current&rdquo;</h1>

<p>cd &ldquo;$rawfolder&rdquo; &amp;&amp; find . ( ! -regex &lsquo;.<em>/..</em>&rsquo; ) -type d &gt; &ldquo;$current/dirs.txt&rdquo; &amp;&amp; cd &ldquo;$current&rdquo;
cp dirs.txt old_dirs.txt</p>

<p>while read folder
do
    # echo converting pictures in &ldquo;$rawfolder/$folder&rdquo;
    mkdir -p &ldquo;$folder&rdquo;
    ls &ldquo;$rawfolder/$folder/&rdquo; &gt; files.txt
    while read i
    # for i in &ldquo;$rawfolder/$folder/*&rdquo;
    do
        # if dng, convert else copy
        if [[ -f &ldquo;$rawfolder/$folder/$i&rdquo; ]]; then
            echo &ldquo;$rawfolder/$folder/$i&rdquo;
            if echo &ldquo;$i&rdquo; | grep -q &lsquo;.dng$&rsquo;; then
                dcraw -c &ldquo;$rawfolder/$folder/$i&rdquo; | cjpeg -quality 90 -optimize -progressive &gt; &ldquo;$folder/$(echo $(basename &ldquo;$i&rdquo; &ldquo;.dng&rdquo;).jpg)&rdquo;
            elif echo &ldquo;$i&rdquo; | grep -q &lsquo;.jpg$&rsquo;; then
                cp &ldquo;$rawfolder/$folder/$i&rdquo; &ldquo;$folder/$i&rdquo;
            fi
        fi
    done &lt; files.txt
done &lt; dirs.txt</p>

<p>echo Done.
</code></pre></p></article></div><footer><div class="copyright tc">2020
<a href=https://creativecommons.org/licenses/by/4.0/ aria-label="Creative Commons license"><i class="fa-lg fab fa-creative-commons"></i><i class="fa-lg fab fa-creative-commons-by"></i></a></div></footer></body></html>