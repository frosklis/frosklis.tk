<!doctype html><html lang=es-es><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Sitio web de Claudio Noguera"><meta name=ROBOTS content="INDEX, FOLLOW"><title>Claudio Noguera</title><script src=https://kit.fontawesome.com/911291c64e.js crossorigin=anonymous></script><link rel=icon href=/favicon.png><link rel=stylesheet href=https://frosklis.tk/main.min.3df621cfdc214478d8b44439244ddcb325a0a4d8182c3af9712ec72f414642a6.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-267152-14','auto');ga('send','pageview');}</script></head><body><nav class=sidebar><a href=https://frosklis.tk/><h1 class=tc>Claudio Noguera</h1></a><div><div class="ml5 mr5 mb2 ma1 tc"><a href=https://frosklis.tk/><img src=/claudio_salinas.jpg class=shadow-1 alt=logo></a></div><div class=tc><a class=ma2 href=https://github.com/frosklis><i class="fa-2x fab fa-github" aria-label=github title=github></i></a><a class=ma2 href=https://linkedin.com/in/claudionoguera><i class="fa-2x fab fa-linkedin" aria-label=linkedin title=linkedin></i></a><a class=ma2 href=https://twitter.com/claudio1985><i class="fa-2x fab fa-twitter" aria-label=twitter title=twitter></i></a><a class=ma2 href=https://goodreads.com/claudio85><i class="fa-2x fab fa-goodreads" aria-label=goodreads title=goodreads></i></a></div></div><div class="copyright tc">2020
<a href=https://creativecommons.org/licenses/by/4.0/ aria-label="Creative Commons license"><i class="fa-lg fab fa-creative-commons"></i><i class="fa-lg fab fa-creative-commons-by"></i></a></div></nav><div id=content><article><header><h1>Mi primer paquete en Pypi</h1><div class=post-meta><i class="far fa-calendar"></i>&nbsp;2020-04-04</div><div class=post-meta><i class="fas fa-tag"></i>&nbsp;
<a href=/tags/pypy>pypy</a>, <a href=/tags/python>python</a>, <a href=/tags/devops>devops</a></div></header><p>He hecho <a href=https://github.com/frosklis/cn-machine-learning>un paquete que he llamado cnml</a>. Y lo estoy haciendo con fines autoformativos porque en los proyectos en los que trabajo nunca hago yo solo el trabajo de principio a fin. Mi conclusión es que cuando los proyectos son de código abierto es mucho más fácil todo.</p><p>Todo empieza por tener un <a href=https://packaging.python.org/tutorials/packaging-projects/>código bien estructurado que se pueda instalar con setuptools</a> y con crearse una cuenta en <a href=https://pypi.org/>pypi.org</a>. El único requisito es que el nombre del paquete no exista en pypi. Hecho eso, el paquete se puede subir por línea de comandos.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>python setup.py dist
twine upload dist<span style=color:#ae81ff>\*</span></code></pre></div><p>Existen formas de automatizar lo anterior para que no sea necesario introducir el nombre de usuario y contraseña cada vez. Pero puestos a hacer eso, es mejor todavía hacer el ciclo completo de devops. Las prácticas de integración continua han mejorado mucho en los últimos años en cuanto a facilidad de uso. Ahora cualquiera lo puede hacer y contribuyen a que el código que tenemos sea mantenible. El desencadenante de todo es un commit. Se puede configurar github (o cualquier repositorio git) para que se desencaden acciones cada vez que ocurre algo. De hecho todos los grandes (github, gitlab, bitbucket y los internos de las plataformas en la nube de Amazon, Google y Microsoft) tienen APIs y se pueden conectar a terceros.</p><p>En el mundo open source el más famoso es <a href=https://jenkins.io/>Jenkins</a>. Los proveedores cloud tienen los suyos, Atlassian tiene el suyo. Lo que no me gusta de Jenkins es que tiene la barrera de entrada de que hace falta una infraestructura donde desplegarlo y hacerlo funcionar. Por eso yo he utilizado <a href=https://travis-ci.com/>Travis</a> que funciona como servicio y es gratis para proyectos opensource. Podía haber utilizado también <a href=https://circleci.com/>Circle CI</a>.</p><p>Usando travis, lo único que hay que hacer es configurar el script .travis.yml que tiene que estar en la raíz del repositorio. <a href=https://github.com/frosklis/cn-machine-learning/blob/master/.travis.yml>El mío es este</a> y hoy (4 de abril de 2020) tiene esta pinta:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>language</span>: python
<span style=color:#66d9ef>script</span>: pytest --cov=cnml
<span style=color:#66d9ef>after_success</span>: bash &lt;(curl -s https://codecov.io/bash)
<span style=color:#66d9ef>deploy</span>:
  <span style=color:#66d9ef>on</span>:
    <span style=color:#66d9ef>tags</span>: <span style=color:#66d9ef>true</span>
  <span style=color:#66d9ef>provider</span>: pypi
  <span style=color:#66d9ef>user</span>: __token__
  <span style=color:#66d9ef>password</span>:
    <span style=color:#66d9ef>secure</span>: lUDdfS0w/P3YF7QospZmVHo0YWuFvuIwuteIQjzUuuJbOlA5K00iNHvuSp9cLx89pFL+dWO61ar2qYechdT1UdtKlvEZpbthgMACMkftY8F+LBUUs95DIph/1arUabr6ZOVyuc6kuc3YvaHMK78FjEB4J5YftRznp3LVLJPpWIjL1oOpPCbI4ETjxA+SvLqQGerKfTPUQWogjB/iDjLOczdWY9y6haHaF43svaFy7LWL2fxTC95PKhXANjGlME0mociZI1aIykZbOk58/WOLew4De7jCeN/sCathBKpq4cAV222RoAV73Rx9FWucS2U4XeRFGMUA8Bvv3T0gCoIzTN1C+wmN7g0SJBqVJkdSf/eN/fPo4sw8Fu0Ohs0iJr1f74h2z6EQeuKdMER5sxEUP1t1HWj8elQ1JwQT1h4AjXJSccGFJcYdvaP4SWr2+2x4uayPbg32R+5iQu0y7WMDtEH5KsNgJ9GBJ7YxLnLImx2UtkF6Iem/AYTYcP2PikW2RbOZM1A4DWakYvMAzegyWj8yjOp65tWfp2ntQ6LzjAJbauzBnVmGkoBAS2zQPv0kbiYoeE0pdQKaHqAl9tU0EjotN/n0DGKrEn0zay+GbMrL0uyDSwCkqHpxdBW5hCVJAzLQg3EJy8lVNyDp3EYq3Bl/bPqjRmWxJC6iLMXo4Z4=</code></pre></div><p>Hace más cosas que simplemente generar el paquete:</p><ol><li>genera el paquete</li><li>ejecuta los tests con cobertura</li><li>manda el informe de esa cobertura a codecov.io para verlo gráficamente</li><li>y sólo si el commit corresponde a una etiqueta sube el paquete a pypi</li></ol><p>Lo que no tengo todavía bien resuelto es el nombrado de versiones. Utilizo el estándar <a href=https://semver.org>semver</a>, pero no de forma tan automatizada como me gustaría. En el repositorio en sí me gustaría hacer sólo lo que estoy haciendo ahora, que es tnner la versión (ahora mismo la 0.2.0 en desarrollo). Pero de cara a subirlo a pypi la versión no puede ser la misma, hay que añadirle apellidos, por ejemplo 0.1.1-dev1. Es la generación de ese apellido la que todavía no tengo bien resuelta.</p><p>Por cierto, no he dicho qué hace el paquete. Lo quiero utilizar para tener ordenadas implementaciones de algoritmos que utilizo para resolver algún problema. Ahora mismo tiene dos: un interpolador de curvas basado en <a href=https://es.wikipedia.org/wiki/Spline>splines</a> y una trasnformación muy útil para modelos binarios, el <a href=https://medium.com/@sundarstyles89/weight-of-evidence-and-information-value-using-python-6f05072e83eb>WoE (peso de la evidencia)</a>. Mi implementación del WoE es más elegante que la del link que pongo, la de los splines de momento no tanto.</p><p>Finalmente, dejo aquí unos enlaces que he leído para poder hacer esto:</p><ul><li><a href=https://ron.sh/how-to-submit-a-package-to-pypi/>Una guía de cómo hacerlo de principio a fin</a></li><li><a href=https://medium.com/@joel.barmettler/how-to-upload-your-python-package-to-pypi-65edc5fe9c56>Consideraciones para subir un paquete a pypi</a></li><li>Tendría que firmar las tags de los repositorios, <a href=https://rem.co/blog/2015/02/12/git-the-difference-between-lightweight-and-annotated-tags/>aquí se explica por qué</a></li></ul></article><script type=text/javascript async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$']],processEscapes:true,processEnvironments:true,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}});MathJax.Hub.Queue(function(){var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=' has-jax';}});MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}});</script></div><footer><div class="copyright tc">2020
<a href=https://creativecommons.org/licenses/by/4.0/ aria-label="Creative Commons license"><i class="fa-lg fab fa-creative-commons"></i><i class="fa-lg fab fa-creative-commons-by"></i></a></div></footer></body></html>